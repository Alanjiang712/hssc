{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}{{ block.super }}<link rel="stylesheet" type="text/css" href="{% static "admin/css/dashboard.css" %}">{% endblock %}

{% block coltype %}colMS{% endblock %}

{% block bodyclass %}{{ block.super }} dashboard{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block nav-sidebar %}{% endblock %}

{% block content %}
    <form method="get">
        <h3>共享服务</h3>
        {% for proc in unassigned_procs %}
            <div class="proc-item">
                <a href="receive_task/{{ proc.id }}">
                    <span class="proc-item-title-time">{{ proc.customer.name }}</span>
                    <span class="proc-item-title-text">{{ proc.service.label }}</span>
                    <span class="proc-item-title-text">{{ proc.customer.workgroup.label }}</span>
                </a>
            </div>
        {% endfor %}
    </form>
    <br>
    <hr>
    <br>
    {% verbatim %}
    <div id="app">
        <div v-for="item in items" :key="item.title">
            <h3>{{ item.title }}</h3>
            <br>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">居民档案号</th>
                        <th scope="col">姓名</th>
                        <th scope="col">服务项目</th>
                        <th scope="col">联系电话</th>
                        <th scope="col">家庭地址</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="todo in item.todos" :key="todo.id">
                        <td>{{ todo.customer_number }}</td>
                        <td><a :href="'customer_service/' + todo.customer_id">{{ todo.customer_name }}</a></td>
                        <td>{{ todo.service_label }}</td>
                        <td>{{ todo.customer_phone }}</td>
                        <td>{{ todo.customer_address }}</td>
                    </tr>
                </tbody>
            </table>
            <br>
            <hr>
            <br>
        </div>
    </div>

    {% endverbatim %}

    <script src="https://unpkg.com/vue@3"></script>
    <script>
        const { createApp } = Vue;

        const customerServiceApp = {
            data() {
                return {
                    message: 'Hello Miles',
                    items: null
                }
            },
            created() {
                const socket = new WebSocket(`ws://${window.location.host}/ws/staff_todo_list/`);
                let _this = this;

                socket.onmessage = function (event) {
                    _this.items = JSON.parse(event.data);
                    console.log(_this.items);
                }
            },
        };

        createApp(customerServiceApp).mount('#app');
    </script>


{% endblock %}
